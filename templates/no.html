<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>Qu·∫£n l√Ω ng∆∞·ªùi d√πng</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body class="bg-light">
    <div class="container mt-4">
      <h2 class="text-center mb-4">üë§ Qu·∫£n l√Ω ng∆∞·ªùi d√πng MongoDB</h2>

      <!-- Form th√™m ng∆∞·ªùi d√πng -->
      <div class="card p-3 mb-4">
        <h5>Th√™m ng∆∞·ªùi d√πng</h5>
        <input
          type="text"
          id="name"
          class="form-control mb-2"
          placeholder="T√™n"
        />
        <input
          type="number"
          id="age"
          class="form-control mb-2"
          placeholder="Tu·ªïi"
        />
        <button class="btn btn-success" onclick="addUser()">Th√™m</button>
      </div>

      <!-- Danh s√°ch ng∆∞·ªùi d√πng -->
      <div class="card p-3">
        <h5>Danh s√°ch ng∆∞·ªùi d√πng</h5>
        <table class="table table-striped">
          <thead>
            <tr>
              <th>T√™n</th>
              <th>Tu·ªïi</th>
              <th>H√†nh ƒë·ªông</th>
            </tr>
          </thead>
          <tbody id="userTable"></tbody>
        </table>
      </div>
    </div>

    <script>
      const API = "http://127.0.0.1:5000";

      // --- L·∫•y danh s√°ch ng∆∞·ªùi d√πng ---
      async function loadUsers() {
        const res = await fetch(`${API}/list`);
        const data = await res.json();
        const table = document.getElementById("userTable");
        table.innerHTML = "";
        data.data.forEach((user) => {
          table.innerHTML += `
          <tr>
            <td>${user.name}</td>
            <td>${user.age}</td>
            <td>
              <button class="btn btn-warning btn-sm" onclick="updateUser('${user._id}')">S·ª≠a</button>
              <button class="btn btn-danger btn-sm" onclick="deleteUser('${user._id}')">X√≥a</button>
            </td>
          </tr>`;
        });
      }

      // --- Th√™m ng∆∞·ªùi d√πng ---
      async function addUser() {
        const name = document.getElementById("name").value;
        const age = document.getElementById("age").value;

        if (!name || !age) return alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!");

        await fetch(`${API}/add`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name, age }),
        });

        document.getElementById("name").value = "";
        document.getElementById("age").value = "";
        loadUsers();
      }

      // --- C·∫≠p nh·∫≠t ng∆∞·ªùi d√πng ---
      async function updateUser(id) {
        const newName = prompt("Nh·∫≠p t√™n m·ªõi:");
        const newAge = prompt("Nh·∫≠p tu·ªïi m·ªõi:");
        if (!newName && !newAge) return;

        await fetch(`${API}/update/${id}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name: newName, age: parseInt(newAge) }),
        });

        loadUsers();
      }

      // --- X√≥a ng∆∞·ªùi d√πng ---
      async function deleteUser(id) {
        if (!confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ng∆∞·ªùi d√πng n√†y?")) return;
        await fetch(`${API}/delete/${id}`, { method: "DELETE" });
        loadUsers();
      }

      // --- T·∫£i danh s√°ch khi m·ªü trang ---
      loadUsers();
    </script>
  </body>
</html>
